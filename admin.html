<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–ì–†–û–≠–ö–û</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #4CAF50; text-align: center; }
        .admin-actions { margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #388E3C; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #4CAF50; color: white; position: sticky; top: 0; }
        tr:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–ì–†–û–≠–ö–û üêΩ</h1>
        <div class="admin-actions">
            <button class="btn-primary" onclick="loadOrders()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑—ã</button>
            <button class="btn-secondary" onclick="exportOrders()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
        </div>
        <div class="orders-table-container">
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                        <th>–ò–º—è</th>
                        <th>Username</th>
                        <th>–ü—Ä–∏–∑</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–§–ò–û</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–ê–¥—Ä–µ—Å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body">
                    <tr><td colspan="10">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('agroeco_orders') || '[]');
            const tbody = document.getElementById('orders-table-body');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            orders.forEach(order => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.date}</td>
                    <td>${order.userId}</td>
                    <td>${order.firstName}</td>
                    <td>${order.username || '-'}</td>
                    <td>${order.itemName}</td>
                    <td>${order.price} üêΩ</td>
                    <td>${order.profile.name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>${order.profile.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                    <td>${order.profile.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                    <td>${order.status}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function exportOrders() {
            const orders = JSON.parse(localStorage.getItem('agroeco_orders') || '[]');
            if (orders.length === 0) {
                alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }
            
            let csv = '–î–∞—Ç–∞,ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,–ò–º—è,Username,–ü—Ä–∏–∑,–¶–µ–Ω–∞,–§–ò–û,–¢–µ–ª–µ—Ñ–æ–Ω,–ê–¥—Ä–µ—Å,–°—Ç–∞—Ç—É—Å\n';
            
            orders.forEach(order => {
                csv += `"${order.date}",${order.userId},"${order.firstName}","${order.username || ''}","${order.itemName}",${order.price},"${order.profile.name || ''}","${order.profile.phone || ''}","${order.profile.address || ''}","${order.status}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'agroeco_orders_full.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadOrders);
    </script>
</body>
</html>
